# 美食食谱分享系统 - 测试指南

## 📋 目录
1. [环境准备](#环境准备)
2. [数据库初始化](#数据库初始化)
3. [启动项目](#启动项目)
4. [功能测试](#功能测试)
5. [常见问题](#常见问题)

---

## 环境准备

### 必需软件
- **Java**: JDK 8 或更高版本
- **Maven**: 3.6+
- **Node.js**: 16+ 
- **MySQL**: 8.0+
- **Git**: 最新版本

### 验证环境
```powershell
# 检查Java版本
java -version

# 检查Maven版本
mvn -version

# 检查Node.js版本
node -v
npm -v

# 检查MySQL版本
mysql --version
```

---

## 数据库初始化

### 步骤1：创建数据库
```sql
CREATE DATABASE IF NOT EXISTS food_recipe CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 步骤2：执行SQL脚本

**方法1：使用MySQL命令行**
```powershell
# 进入项目目录
cd d:\akaifa\food\database

# 执行表结构脚本
mysql -u root -p123456 food_recipe < schema.sql

# 执行初始数据脚本
mysql -u root -p123456 food_recipe < data.sql
```

**方法2：使用MySQL客户端（推荐）**
1. 打开Navicat/DBeaver/MySQL Workbench
2. 连接到MySQL（用户名：root，密码：123456）
3. 选择 `food_recipe` 数据库
4. 依次执行：
   - `d:\akaifa\food\database\schema.sql`
   - `d:\akaifa\food\database\data.sql`

### 步骤3：验证数据
```sql
-- 检查表是否创建成功
SHOW TABLES;

-- 应该看到8张表：
-- user, tag, recipe, recipe_ingredient, recipe_step, 
-- recipe_tag, comment, favorite

-- 检查初始数据
SELECT * FROM user;  -- 应该有3个用户（1个管理员，2个普通用户）
SELECT * FROM tag;   -- 应该有多个预设标签
SELECT * FROM recipe; -- 应该有1个示例食谱
```

---

## 启动项目

### 启动后端

**步骤1：进入后端目录**
```powershell
cd d:\akaifa\food\food-recipe-backend
```

**步骤2：首次运行需要安装依赖**
```powershell
mvn clean install -DskipTests
```

**步骤3：启动Spring Boot**
```powershell
mvn spring-boot:run
```

**步骤4：验证后端启动成功**
- 看到日志：`Started FoodRecipeApplication`
- 访问API文档：http://localhost:8080/doc.html
- 应该能看到Knife4j接口文档页面

### 启动前端

**步骤1：打开新的PowerShell窗口，进入前端目录**
```powershell
cd d:\akaifa\food\food-recipe-frontend
```

**步骤2：首次运行需要安装依赖**
```powershell
npm install
```
> 注意：如果 `npm install` 很慢，可以使用国内镜像：
> ```powershell
> npm config set registry https://registry.npmmirror.com
> npm install
> ```

**步骤3：启动开发服务器**
```powershell
npm run dev
```

**步骤4：验证前端启动成功**
- 看到消息：`Local: http://localhost:5173/`
- 打开浏览器访问：http://localhost:5173
- 应该能看到首页

---

## 功能测试

### 测试账号
数据库已预设以下测试账号：

| 账号类型 | 用户名 | 密码 | 说明 |
|---------|--------|------|------|
| 管理员 | admin | admin123 | 拥有管理权限 |
| 普通用户1 | user1 | user123 | 测试用户 |
| 普通用户2 | user2 | user123 | 测试用户 |

### 1. 用户认证功能测试

#### 1.1 注册新用户
1. 访问首页：http://localhost:5173
2. 点击右上角【注册】按钮
3. 填写注册信息：
   - 用户名：testuser（3-50个字符）
   - 密码：test123（6-20个字符）
   - 昵称：测试用户
   - 邮箱：test@example.com（可选）
4. 点击【注册】按钮
5. ✅ 验证：提示"注册成功"，自动跳转到登录页

#### 1.2 用户登录
1. 在登录页面输入：
   - 用户名：testuser（或使用预设账号user1）
   - 密码：test123（或user123）
2. 点击【登录】
3. ✅ 验证：
   - 提示"登录成功"
   - 跳转到首页
   - 右上角显示用户昵称
   - 导航栏出现"我的食谱"、"我的收藏"、"发布食谱"菜单

#### 1.3 退出登录
1. 点击右上角用户昵称下拉菜单
2. 选择【退出登录】
3. ✅ 验证：跳转到登录页，导航栏恢复到未登录状态

---

### 2. 食谱管理功能测试

#### 2.1 发布食谱
1. 确保已登录
2. 点击导航栏【发布食谱】
3. 填写食谱信息：
   - **标题**：家常红烧肉
   - **封面图**：点击上传图片
   - **简介**：经典中式菜肴，肥而不腻
   - **菜系**：选择"川菜"或"家常菜"
   - **难度**：选择"中等"
   - **烹饪时长**：60分钟
   - **份量**：4人份
4. 添加食材：
   - 点击【添加食材】按钮
   - 输入：五花肉 / 500g
   - 输入：冰糖 / 30g
   - 输入：生抽 / 2勺
5. 添加步骤：
   - 点击【添加步骤】按钮
   - 在富文本编辑器中输入步骤内容
   - 可以点击编辑器工具栏上传图片
   - 支持文字格式化（加粗、列表等）
6. 点击【发布】
7. ✅ 验证：
   - 提示"发布成功"
   - 跳转到"我的食谱"页面
   - 能看到刚发布的食谱

#### 2.2 浏览食谱列表
1. 点击导航栏【食谱】
2. ✅ 验证：
   - 显示食谱卡片列表（包括预设的示例食谱）
   - 每个卡片显示：封面图、标题、简介、标签、浏览数、收藏数、评论数
3. 测试搜索功能：
   - 在搜索框输入"红烧肉"
   - 点击搜索图标
   - ✅ 验证：只显示匹配的食谱
4. 测试筛选功能：
   - 选择菜系："川菜"
   - ✅ 验证：只显示川菜类食谱
   - 选择难度："简单"
   - ✅ 验证：只显示简单难度的食谱

#### 2.3 查看食谱详情
1. 点击任意食谱卡片
2. ✅ 验证：
   - 显示完整的食谱信息：
     - 封面图、标题、简介
     - 标签（菜系、难度、时长、份量）
     - 浏览次数、收藏数、评论数
     - 作者信息（头像、昵称、发布时间）
     - 食材列表（表格形式）
     - 制作步骤（序号、内容、配图）
   - 浏览次数自动+1

#### 2.4 编辑食谱
1. 进入【我的食谱】页面
2. 点击某个食谱进入详情页
3. （注：当前版本编辑功能在食谱列表页，您可以通过重新发布来修改）
4. ✅ 验证：只能编辑自己发布的食谱

#### 2.5 删除食谱
1. 在【我的食谱】页面
2. （注：当前版本删除功能需要通过后端API或数据库操作）
3. ✅ 验证：软删除，数据库中 `is_deleted=1`

---

### 3. 评论功能测试

#### 3.1 发表评论
1. 进入任意食谱详情页
2. 确保已登录
3. 在页面底部"用户评论"区域：
   - **评分**：选择星级（1-5星）
   - **评论内容**：输入至少5个字符
   - 例如："做法很详细，味道很不错！"
4. 点击【发表评论】
5. ✅ 验证：
   - 提示"评论成功"
   - 评论出现在列表顶部
   - 显示：用户头像、昵称、评分星级、内容、时间
   - 食谱的评论数+1

#### 3.2 查看评论列表
1. 在食谱详情页滚动到评论区
2. ✅ 验证：
   - 显示所有评论（按时间倒序）
   - 每条评论显示完整信息
   - 支持分页（超过10条时）

#### 3.3 删除评论
1. 在自己发表的评论右侧
2. 点击【删除】按钮
3. 确认删除
4. ✅ 验证：
   - 提示"删除成功"
   - 评论从列表消失
   - 食谱的评论数-1

---

### 4. 收藏功能测试

#### 4.1 收藏食谱
1. 进入任意食谱详情页
2. 确保已登录
3. 在食谱标题下方，点击【收藏】按钮（星形图标）
4. ✅ 验证：
   - 提示"收藏成功"
   - 按钮变为【已收藏】（红色，实心星）
   - 食谱的收藏数+1

#### 4.2 取消收藏
1. 在已收藏的食谱详情页
2. 点击【已收藏】按钮
3. ✅ 验证：
   - 提示"已取消收藏"
   - 按钮变回【收藏】（蓝色，空心星）
   - 食谱的收藏数-1

#### 4.3 查看我的收藏
1. 点击导航栏【我的收藏】
2. ✅ 验证：
   - 显示所有已收藏的食谱
   - 使用与食谱列表相同的卡片样式
   - 支持分页
   - 空状态提示："还没有收藏任何食谱哦"

---

### 5. 图片上传功能测试

#### 5.1 封面图上传
1. 在发布食谱页面
2. 点击"上传图片"区域
3. 选择图片文件（支持jpg、jpeg、png、gif）
4. ✅ 验证：
   - 图片大小不超过10MB
   - 上传成功后显示预览
   - 鼠标悬停显示【编辑】图标可重新上传

#### 5.2 富文本编辑器图片上传
1. 在添加步骤时
2. 点击编辑器工具栏的"图片"图标
3. 选择图片文件
4. ✅ 验证：
   - 图片自动插入到编辑器当前位置
   - 图片可以正常显示
   - 保存后在详情页能正确展示

---

### 6. 路由守卫测试

#### 6.1 未登录访问受保护页面
1. 确保处于未登录状态（或先退出登录）
2. 直接访问：http://localhost:5173/recipe/create
3. ✅ 验证：
   - 提示"请先登录"
   - 自动跳转到登录页

#### 6.2 已登录访问登录页
1. 确保已登录
2. 直接访问：http://localhost:5173/login
3. ✅ 验证：自动跳转到首页

---

### 7. API文档测试（可选）

#### 7.1 访问Knife4j文档
1. 访问：http://localhost:8080/doc.html
2. ✅ 验证：
   - 显示Swagger UI界面
   - 左侧列出所有API分组
   - 展开可以看到接口详情

#### 7.2 测试API接口
1. 在Knife4j页面点击【认证管理】→【用户登录】
2. 点击【调试】
3. 填写请求参数：
   ```json
   {
     "username": "user1",
     "password": "user123"
   }
   ```
4. 点击【发送】
5. ✅ 验证：
   - 返回状态码200
   - 响应包含token和用户信息

---

## 常见问题

### Q1: 后端启动失败，提示数据库连接错误
**A:** 检查以下几点：
1. MySQL服务是否启动
2. 数据库名称是否为 `food_recipe`
3. 用户名密码是否为 `root` / `123456`
4. 修改配置文件：`food-recipe-backend/src/main/resources/application.yml`

### Q2: 前端无法连接后端
**A:** 确认：
1. 后端是否在 http://localhost:8080 运行
2. 浏览器控制台是否有CORS错误
3. 检查 `food-recipe-frontend/vite.config.ts` 中的代理配置

### Q3: 图片上传失败
**A:** 检查：
1. 后端日志中的错误信息
2. 上传目录是否存在：`d:/akaifa/food/upload/`
3. 文件大小是否超过10MB
4. 文件格式是否为jpg/jpeg/png/gif

### Q4: npm install 很慢
**A:** 使用国内镜像：
```powershell
npm config set registry https://registry.npmmirror.com
npm install
```

### Q5: Maven下载依赖很慢
**A:** 配置阿里云镜像：
在 `~/.m2/settings.xml` 添加：
```xml
<mirrors>
  <mirror>
    <id>aliyun</id>
    <mirrorOf>central</mirrorOf>
    <url>https://maven.aliyun.com/repository/public</url>
  </mirror>
</mirrors>
```

### Q6: 富文本编辑器不显示
**A:** 
1. 检查浏览器控制台是否有错误
2. 确认 `@vueup/vue-quill` 已安装
3. 刷新页面或重启前端服务

---

## 性能测试建议

### 1. 并发用户测试
- 使用多个浏览器（Chrome、Firefox、Edge）同时登录不同账号
- 测试多用户同时发布食谱、评论、收藏

### 2. 大数据量测试
- 发布20+个食谱
- 添加100+条评论
- 测试分页功能是否正常

### 3. 图片上传测试
- 上传不同大小的图片（1MB、5MB、10MB）
- 上传不同格式的图片
- 测试上传速度

---

## 测试清单

### 必测项
- [ ] 用户注册
- [ ] 用户登录
- [ ] 发布食谱（含图片上传）
- [ ] 浏览食谱列表
- [ ] 查看食谱详情
- [ ] 发表评论和评分
- [ ] 收藏/取消收藏食谱
- [ ] 查看我的食谱
- [ ] 查看我的收藏

### 扩展测试项
- [ ] 搜索功能
- [ ] 筛选功能
- [ ] 分页功能
- [ ] 删除评论
- [ ] 路由守卫
- [ ] Token过期处理
- [ ] 表单验证
- [ ] 错误提示

---

## 联系支持

如遇到问题，请检查：
1. 浏览器控制台的错误信息
2. 后端终端的日志输出
3. 数据库数据是否正确

**祝测试顺利！** 🎉
